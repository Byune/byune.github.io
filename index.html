<!DOCTYPE html>
<html lang="en">

<head>

    <title>자연재난 시뮬레이션 - 감염병</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/build/ol.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/css/ol.css">
     
     <!-- jquery slider -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-icon">
                    <i class="fas fa-head-side-mask"></i>
                    
                </div>
                <div class="sidebar-brand-text mx-3"> UrbanDisaster </div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider" >

            <!-- Heading -->
            <div class="sidebar-heading">
                자연재난 시뮬레이션
            </div>          

            <!-- Nav Item - Pages Collapse Menu -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="index.html" aria-expanded="true" aria-controls="collapseTwo">
                    <i class="fas fa-viruses"></i>
                    <span>감염병</span>
                </a>
            </li>
            <li class = "nav-item">
                <a class = "nav-link collapsed" herf = "index.html" aria-expanded="true" aria-controls="collapesTwo">
                    <a class="nav-link collapsed" href="http://222.239.90.78:53080/" id="userDropdown" role="button" aria-haspopup="true" aria-expanded="false">
                        <i class = "fas fa-viruses"></i>
                        <spna>SEIR 모델</spna>
                    </a>
                </a>
            </li>
  
            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

        </ul>
        <!-- End of Sidebar -->
        <div id="move-cont1" class="move-cont" style="display: block">
            <!-- 확진자 현황(자치구별) : START -->
            <div class="status-confirm map-status display-none">
                <h4>확진자 현황(자치구별)</h4>
                <p class="txt-status">('20.12.02.00시 기준)</p>
                <div class="seoul-map-wrap">
                    <div class="seoul-map seoul-map-all">
                        <img src="/res_newseoul/images/corona/img_basic_map1.png" alt="서울시 지도">
                        <span class="district district1 on"><em class="sr-only">종로구</em><span class="num">128</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district1.png" alt="" /></span></span>
                        <span class="district district2 on"><em class="sr-only">강서구</em><span class="num">618</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district2.png" alt="" /></span></span>
                        <span class="district district3 on"><em class="sr-only">성북구</em><span class="num">467</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district3.png" alt="" /></span></span>
                        <span class="district district4 on"><em class="sr-only">서대문구</em><span class="num">269</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district4.png" alt="" /></span></span>
                        <span class="district district5 on"><em class="sr-only">성동구</em><span class="num">224</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district5.png" alt="" /></span></span>
                        <span class="district district6 on"><em class="sr-only">서초구</em><span class="num">490</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district6.png" alt="" /></span></span>
                        <span class="district district7 on"><em class="sr-only">중랑구</em><span class="num">304</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district7.png" alt="" /></span></span>
                        <span class="district district8 on"><em class="sr-only">강동구</em><span class="num">287</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district8.png" alt="" /></span></span>
                        <span class="district district9 on"><em class="sr-only">구로구</em><span class="num">280</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district9.png" alt="" /></span></span>
                        <span class="district district10 on"><em class="sr-only">송파구</em><span class="num">625</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district10.png" alt="" /></span></span>
                        <span class="district district11 on"><em class="sr-only">마포구</em><span class="num">297</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district11.png" alt="" /></span></span>
                        <span class="district district12 on"><em class="sr-only">은평구</em><span class="num">369</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district12.png" alt="" /></span></span>
                        <span class="district district13 on"><em class="sr-only">관악구</em><span class="num">556</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district13.png" alt="" /></span></span>
                        <span class="district district14 on"><em class="sr-only">금천구</em><span class="num">125</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district14.png" alt="" /></span></span>
                        <span class="district district15 on"><em class="sr-only">중구</em><span class="num">112</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district15.png" alt="" /></span></span>
                        <span class="district district16 on"><em class="sr-only">용산구</em><span class="num">235</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district16.png" alt="" /></span></span>		
                        <span class="district district17 on"><em class="sr-only">광진구</em><span class="num">193</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district17.png" alt="" /></span></span>
                        <span class="district district18 on"><em class="sr-only">동대문구</em><span class="num">317</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district18.png" alt="" /></span></span>
                        <span class="district district19 on"><em class="sr-only">강북구</em><span class="num">202</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district19.png" alt="" /></span></span>
                        <span class="district district20 on"><em class="sr-only">도봉구</em><span class="num">329</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district20.png" alt="" /></span></span>
                        <span class="district district21 on"><em class="sr-only">노원구</em><span class="num">488</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district21.png" alt="" /></span></span>
                        <span class="district district22 on"><em class="sr-only">양천구</em><span class="num">322</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district22.png" alt="" /></span></span>		
                        <span class="district district23 on"><em class="sr-only">영등포구</em><span class="num">316</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district23.png" alt="" /></span></span>
                        <span class="district district24 on"><em class="sr-only">동작구</em><span class="num">401</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district24.png" alt="" /></span></span>		
                        <span class="district district25 on"><em class="sr-only">강남구</em><span class="num">531</span><span class="img-on"><img src="/res_newseoul/images/corona/img_on_district25.png" alt="" /></span></span>	

                        <a href="http://www.jongno.go.kr" target="_blank" class="dist dist1">종로구</a>
                        <a href="http://www.junggu.seoul.kr" target="_blank" class="dist dist2">중구</a>
                        <a href="http://www.yongsan.go.kr" target="_blank" class="dist dist3">용산구</a>
                        <a href="http://www.sd.go.kr/sd/intro.do" target="_blank" class="dist dist4">성동구</a>
                        <a href="http://www.gwangjin.go.kr" target="_blank" class="dist dist5">광진구</a>
                        <a href="http://www.ddm.go.kr" target="_blank" class="dist dist6">동대문구</a>
                        <a href="https://www.jungnang.go.kr/intro.jsp" target="_blank" class="dist dist7">중랑구</a>
                        <a href="http://www.sb.go.kr" target="_blank" class="dist dist8">성북구</a>
                        <a href="http://www.gangbuk.seoul.kr" target="_blank" class="dist dist9">강북구</a>
                        <a href="http://www.dobong.go.kr" target="_blank" class="dist dist10">도봉구</a>
                        <a href="https://www.nowon.kr/corona19/index.do" target="_blank" class="dist dist11">노원구</a>
                        <a href="https://www.ep.go.kr/CmsWeb/viewPage.req?idx=PG0000004918" target="_blank" class="dist dist12">은평구</a>
                        <a href="http://www.sdm.go.kr/index.do" target="_blank" class="dist dist13">서대문구</a>
                        <a href="http://www.mapo.go.kr" target="_blank" class="dist dist14">마포구</a>
                        <a href="http://www.yangcheon.go.kr/site/yangcheon/coronaStatusList.do" target="_blank" class="dist dist15">양천구</a>
                        <a href="http://www.gangseo.seoul.kr/new_portal/living/safe/page06_07.jsp" target="_blank" class="dist dist16">강서구</a>
                        <a href="https://www.guro.go.kr/corona2.jsp" target="_blank" class="dist dist17">구로구</a>
                        <a href="http://www.geumcheon.go.kr" target="_blank" class="dist dist18">금천구</a>
                        <a href="http://www.ydp.go.kr" target="_blank" class="dist dist19">영등포구</a>
                        <a href="http://www.dongjak.go.kr" target="_blank" class="dist dist20">동작구</a>
                        <a href="https://blog.naver.com/gwanak_gu" target="_blank" class="dist dist21">관악구</a>
                        <a href="https://www.seocho.go.kr/html/notice/main.jsp" target="_blank" class="dist dist22">서초구</a>
                        <a href="http://www.gangnam.go.kr" target="_blank" class="dist dist23">강남구</a>
                        <a href="http://www.songpa.go.kr" target="_blank" class="dist dist24">송파구</a>
                        <a href="http://www.gangdong.go.kr" target="_blank" class="dist dist25">강동구</a>
                        

                    </div>
                    <div class="seoul-map seoul-map-other on">
                        <img src="/res_newseoul/images/corona/img_basic_other.png" alt="기타 ">
                        <span class="district district26"><em class="sr-only">기타</em><span class="num">674</span></span>
                    </div>
                    <div class="seoul-map seoul-map-check ">
                        <img src="/res_newseoul/images/corona/img_basic_check.png" alt="확인중">
                        <span class="district district26"><em class="sr-only">확인중</em><span class="num"></span></span>
                    </div>
                </div>
            </div>
        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>
                    
                    <!-- Topbar Search -->
                    <form class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                        <div class="input-group">
                            <input type="text" class="form-control bg-light border-0 small" placeholder="원하시는 색을 입력하세요..." aria-label="Search" aria-describedby="basic-addon2">
                            <div class="input-group-append">
                                <button class="btn btn-default" type="button">
                                    <i class="fas fa-check fa-sm"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                    
                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav ml-auto">

                        <!-- Nav Item - User Information -->
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                    <span class="mr-2 d-none d-lg-inline text-gray-600 small">본인 이름쓰기</span>
                                    <img class="img-profile rounded-circle"src="img/undraw_profile.svg">
                            </a>
                        </li>

                    </ul>

                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container" style="height: 70%;">
                    
                    <!-- 여기서부터 우리의 html소스 main 시작 -->
                    <div id="map" class="map" style="width: 100%; height: 100%;"></div>
                    
                    <input type="range" class="custom-range" min="" max="" id="rangeBar" value="0">
                    <label>선택시간 : </label> <label id="hour">0</label>일째
                    <!-- 여기서부터 우리의 html소스 main 끝 -->
                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->


        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <script type="text/javascript">

    //분석결과값 전역변수에 저장
    var resultjson = {};
    $.getJSON("https://vaiv02.github.io/result.json", function(data){
        resultjson = data;
    });
    //style 지정
    var style = new ol.style.Style({
        fill: new ol.style.Fill({
        color: 'rgba(255, 255, 255, 0.5)',
        }),
        stoke: new ol.style.Stroke({
        color: 'grey',
        width: 1,
        }),
        text: new ol.style.Text({
            font: '8px calibri,sans-serif',
            fill: new ol.style.Fill({
            color: 'blue',
            }),
            stroke: new ol.style.Stroke({
            color: 'white',
            width: 3,
            }),
        }),
    });
        // 두개의 날짜를 비교하여 차이를 알려준다. return 값 : 두 날짜의 차이 일수
    function dateDiff(start) {
        var startDate = start instanceof Date ? start : new Date(start);
        //var endDate = '2020-11-20';//new Date(); //오늘날짜
        startDate =new Date(startDate.getFullYear(), startDate.getMonth()+1, startDate.getDate());
        endDate =new Date('2020', '11','20');
        var diff = Math.abs(endDate.getTime() - startDate.getTime());
        diff = Math.ceil(diff / (1000 * 3600 * 24));
        return diff + 1;
    }
    function getColor(num){
        var colorList = ["#FFE6E6","#FFCCCC","#FFB3B3","#FF8080","#FF4D4D","#FF1A1A","#E60000","#B30000","#800000","#4D0000"];
        return colorList[Math.floor(num / 50)];     // 50씩 구분
    }
    //map 속성지정
    var map = new ol.Map({
        target: 'map',
        layers: [
            new ol.layer.Tile({
            source: new ol.source.OSM()
            })
        ],
        interactions: ol.interaction.defaults({
            dragPan: false
        }),
        view: new ol.View({
            center: ol.proj.fromLonLat([127.0016985,37.5642135]),
            minZoom: 11,
            zoom: 11
        })
    });
    
    //좌표 + 속성정보를 저장하기 위한 source 객체 생성
    var mySource=new ol.source.Vector({
        format: new ol.format.GeoJSON({
        featureProjection:'EPSG:3857'
        })
    });
    //source 객체에 서울시에 대한 정보(행정구역코드, 행정구역 명 등등)와 좌표 정보 setting
    $.getJSON("sgg09.geojson", function(data) { //./emd09.geojson
        mySource.addFeatures((new ol.format.GeoJSON()).readFeatures(data));
    }).done(function(){ //위 로직이 완료 되면 실행
        //source 객체에 우리가 분석한 결과에 대한 속성 정보를 추가 setting
        mySource.forEachFeature(function(feature){
            var featureStyle = style.clone();
            featureStyle.getText().setText(feature.get("SIG_KOR_NM"));
            feature.setStyle(featureStyle);
        });
    });
    //layer 객체 생성
    var Vectorlayer = new ol.layer.Vector({
        source: mySource
    });
    //map에 layer를 올린다.
    map.addLayer(Vectorlayer);
    $(function(){
        //슬라이드바를 움직였을때 발생하는 change event
        $("#rangeBar").change(function(){
            //hour의 이름을 가진 element에게 현재의 슬라이드바의 값을 setting
            $("#hour").text($("#rangeBar").val());
            //우리가 선택한 일자에 대한 정보들 가져오기
            var obj = resultjson[$("#rangeBar").val().toString()];
            //색칠을 위한 feature ㄱㅏ져오기
            mySource.forEachFeature(function(feature){
                var sigCd = feature.get("SIG_CD");
                var color = getColor(parseInt(obj[sigCd].infected));
                var fillColor = new ol.style.Fill({
                    color: color
                });
                var feauterStyle = feature.getStyle();
                //feauterStyle.getText().setText(feature.get('SIG_KOR_NM'));
                feauterStyle.setFill(fillColor);
                feature.setStyle(feauterStyle);
            });
        // console.log(sigCd)
        });
        //슬라이드바의 최대 max값을 오늘날짜 - 2020/01/20까지의 날짜 차이만큼 setting
        $("#rangeBar").attr({"max":dateDiff("2020-01-20")});
    });

    </script>


</body>

</html>